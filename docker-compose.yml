services:
  revenue-forecast-sync:
    build:
      context: .
      dockerfile: Dockerfile
    image: strakertech/revenue-forecast-sync:prod-latest
    container_name: revenue-forecast-sync-production
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - MYSQL_HOST=${MYSQL_HOST}
      - MYSQL_USER=${MYSQL_USER}
      - MYSQL_PASSWORD=${MYSQL_PASSWORD}
      - MYSQL_DATABASE=${MYSQL_DATABASE}
      - MYSQL_PORT=${MYSQL_PORT}
      - APP_URL=${APP_URL}
      - BOOKINGS_SYNC_API_KEY=${BOOKINGS_SYNC_API_KEY}
    volumes:
      - ./last_sync.txt:/app/last_sync.txt
    command: python sync_app.py
    healthcheck:
      test: ["CMD", "python", "-c", "import sys; sys.exit(0)"]
      interval: 300s
      timeout: 30s
      retries: 2
      start_period: 30s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"